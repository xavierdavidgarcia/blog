<!doctype html>
<html>
<head>
    <base href="/">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="author" content="Xavier Garcia">

<meta name="description" content="">

<title>Design Patterns in Golang - Part-1</title>
<meta name="generator" content="Hugo 0.57.2" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/pojoaque.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
<link  href="/css/theme.min.css" rel="stylesheet" type="text/css">

</head>
<body>
<div class="page-container container-fluid">
<div class="col-md-3 menu">
    <nav class="col-md-3">
    <h3 class="home-link"><a href="https://xavier-garcia.com">Root</a></h3>
    <div id="last-posts" class="open">
        <h3 data-open="last-posts">Xavier Garcia - Most recent posts</h3>
        <ul>
            
            <li><a href="/post/minikube-and-debian9/">How to setup minikube lab on debian 9 with virtualbox</a></li>
            
            <li><a href="/post/moving_kops_aws_kubernetes_api_from_public_to_internal_elb/">Moving Kops Aws Kubernetes API from Public to Internal ELB</a></li>
            
            <li><a href="/post/how_to_create_a_helm_chart_repository_using_amazon_s3/">How to create a Helm chart repository using Amazon S3</a></li>
            
            <li><a href="/post/configure_automatically_external_dns_on_kubernetes/">Configure automatically external dns on Kubernetes</a></li>
            
            <li><a href="/post/manage_your_friends_with_microservice_in_golang/">Manage your friends with a microservice in Golang</a></li>
            
            <li><a href="/post/what_is_tensor_flow/">What is TensorFLow</a></li>
            
            <li><a href="/post/deploy_kubernetes_cluster_with_kops/">Deploy Kubernetes cluster with Kops and AWS s3 state</a></li>
            
            <li><a href="/post/install_lets_encrypt_debian_9_nginx/">Install Let&#39;s Encrypt with Nginx on Debian 9</a></li>
            
            <li><a href="/post/design_patterns_in_golang-part-5/">Design Patterns in Golang - Part-5</a></li>
            
            <li><a href="/post/design_patterns_in_golang-part-4/">Design Patterns in Golang - Part-4</a></li>
            
            <li><a href="/post/design_patterns_in_golang-part-3/">Design Patterns in Golang - Part-3</a></li>
            
            <li><a href="/post/design_patterns_in_golang-part-2/">Design Patterns in Golang - Part-2</a></li>
            
            <li><a href="/post/design_patterns_in_golang-part-1/">Design Patterns in Golang - Part-1</a></li>
            
            <li><a href="/post/how_do_i_get_the_certificate_authority_certificate_key/">How do I get the certificate authority certificate/key from a cluster created by kops?</a></li>
            
            <li><a href="/post/install_drdb_cluster_on_centos_7/">Install DRDB Cluster on Centos 7</a></li>
            
            <li><a href="/post/write_functions_in_functional_programming_style_in_scala/">Write Functions In Functional Programming Style In Scala</a></li>
            
            <li><a href="/post/decision_trees_in_python/">Decision trees in python</a></li>
            
            <li><a href="/post/logistic_regression_in_python/">Logistic Regression in python</a></li>
            
            <li><a href="/post/linear_regression_in_python/">Linear Regression in python</a></li>
            
            <li><a href="/post/clean_clean_my_docker/">Clean clean my docker</a></li>
            
            <li><a href="/post/my_docker_alias/">Docker alias for your zsh</a></li>
            
            <li><a href="/post/encryption_with_rsa/">Encryption with an RSA</a></li>
            
            <li><a href="/post/how_to_write_good_post_mortem/">How to Write a good post mortem</a></li>
            
            <li><a href="/post/how_to_write_product_requirements_document/">How to Write a Product Requirements Document (PRD)</a></li>
            
            <li><a href="/post/curl_http-2_support/">cURL HTTP/2 support</a></li>
            
            <li><a href="/post/template-7/">Bindwith PostgreSQL backend at CentOS 6.4</a></li>
            
            <li><a href="/post/how_to_install_and_configure_glusterfs_server_on_ubuntu/">How to install and configure GlusterFS Server on Ubuntu</a></li>
            
            <li><a href="/post/template-5/">Linear Regression in python</a></li>
            
            <li><a href="/post/ipv6_on_ubiquity_edge_router_lite/">Activate IPv6 on Ubiquity Edge router lite</a></li>
            
        </ul>
    </div>

    
    <div id="tags" class="open">
        <h3 data-open="tags">Tags</h3>
        <ul class="tags" style="display: none;">
            
            <li><a href="/tags/agile">agile</a></li>
            
            <li><a href="/tags/aws">aws</a></li>
            
            <li><a href="/tags/centos">centos</a></li>
            
            <li><a href="/tags/code">code</a></li>
            
            <li><a href="/tags/container">container</a></li>
            
            <li><a href="/tags/curl">curl</a></li>
            
            <li><a href="/tags/debian">debian</a></li>
            
            <li><a href="/tags/design">design</a></li>
            
            <li><a href="/tags/designpattern">designpattern</a></li>
            
            <li><a href="/tags/dev">dev</a></li>
            
            <li><a href="/tags/development">development</a></li>
            
            <li><a href="/tags/devops">devops</a></li>
            
            <li><a href="/tags/dns">dns</a></li>
            
            <li><a href="/tags/docker">docker</a></li>
            
            <li><a href="/tags/drdb">drdb</a></li>
            
            <li><a href="/tags/encrypt">encrypt</a></li>
            
            <li><a href="/tags/filesystem">filesystem</a></li>
            
            <li><a href="/tags/functional">functional</a></li>
            
            <li><a href="/tags/glusterfs">glusterfs</a></li>
            
            <li><a href="/tags/go">go</a></li>
            
            <li><a href="/tags/golang">golang</a></li>
            
            <li><a href="/tags/helm">helm</a></li>
            
            <li><a href="/tags/http">http</a></li>
            
            <li><a href="/tags/ipv6">ipv6</a></li>
            
            <li><a href="/tags/kops">kops</a></li>
            
            <li><a href="/tags/kubernetes">kubernetes</a></li>
            
            <li><a href="/tags/lab">lab</a></li>
            
            <li><a href="/tags/letsencrypt">letsencrypt</a></li>
            
            <li><a href="/tags/linux">linux</a></li>
            
            <li><a href="/tags/machinelearning">machinelearning</a></li>
            
            <li><a href="/tags/microservice">microservice</a></li>
            
            <li><a href="/tags/minikube">minikube</a></li>
            
            <li><a href="/tags/mongodb">mongodb</a></li>
            
            <li><a href="/tags/network">network</a></li>
            
            <li><a href="/tags/nginx">nginx</a></li>
            
            <li><a href="/tags/postmortem">postmortem</a></li>
            
            <li><a href="/tags/prd">prd</a></li>
            
            <li><a href="/tags/product">product</a></li>
            
            <li><a href="/tags/project_management">project_management</a></li>
            
            <li><a href="/tags/python">python</a></li>
            
            <li><a href="/tags/router">router</a></li>
            
            <li><a href="/tags/rsa">rsa</a></li>
            
            <li><a href="/tags/s3">s3</a></li>
            
            <li><a href="/tags/scala">scala</a></li>
            
            <li><a href="/tags/scrum">scrum</a></li>
            
            <li><a href="/tags/security">security</a></li>
            
            <li><a href="/tags/shell">shell</a></li>
            
            <li><a href="/tags/ssh">ssh</a></li>
            
            <li><a href="/tags/ssl">ssl</a></li>
            
            <li><a href="/tags/startup">startup</a></li>
            
            <li><a href="/tags/tensorflow">tensorflow</a></li>
            
            <li><a href="/tags/ubiquity">ubiquity</a></li>
            
        </ul>
    </div>
    

    
</nav>

</div>
<div class="col-md-9 content">

<h1>Design Patterns in Golang - Part-1</h1>
<h4>Published 10-03-2017 00:00:00</h4>

<article>
    

<h3 id="introduction">Introduction</h3>

<p>Recently I started a series of articles about Gang of Four Design Patterns and their adoption in Golang. They made a lot of noise in the community. I read a lot of contradictionary opionions whether should be used or not. I am publishing those articles as show case how the common design patterns can be adopted and implemented in Golang. I don’t encourage or promote their usage. Every developer has own style of programming, architecture desing and problem solving solutions.</p>

<p>The Design Patterns have never been something encourage by the Golang community. They are not idiomatic for the language. Everybody knows that the language itself is very opioninated and idiomatic. There are no so many ways to achieve particular task or solve particular problem.</p>

<h4 id="creational-patterns">Creational patterns</h4>

<p>Creational design patterns abstract the instantiation process. They help make a system independent of how its objects are created, composed, and represented.</p>

<h4 id="builder-pattern">Builder Pattern</h4>

<p>Builder pattern separates the construction of a complex object from its
representation so that the same construction process can create different
representations.</p>

<p>In Go, normally a configuration struct is used to achieve the same behavior,
however passing a struct to the builder method fills the code with boilerplate
<code>if cfg.Field != nil {...}</code> checks.</p>

<h3 id="implementation">Implementation</h3>

<pre><code>package car

type Speed float64

const (
    MPH Speed = 1
    KPH       = 1.60934
)

type Color string

const (
    BlueColor  Color = &quot;blue&quot;
    GreenColor       = &quot;green&quot;
    RedColor         = &quot;red&quot;
)

type Wheels string

const (
    SportsWheels Wheels = &quot;sports&quot;
    SteelWheels         = &quot;steel&quot;
)

type Builder interface {
    Color(Color) Builder
    Wheels(Wheels) Builder
    TopSpeed(Speed) Builder
    Build() Interface
}

type Interface interface {
    Drive() error
    Stop() error
}
</code></pre>

<h2 id="usage">Usage</h2>

<pre><code>assembly := car.NewBuilder().Paint(car.RedColor)

familyCar := assembly.Wheels(car.SportsWheels).TopSpeed(50 * car.MPH).Build()
familyCar.Drive()

sportsCar := assembly.Wheels(car.SteelWheels).TopSpeed(150 * car.MPH).Build()
sportsCar.Drive()
</code></pre>

<h1 id="factory-method-pattern">Factory Method Pattern</h1>

<p>Factory method creational design pattern allows creating objects without having
to specify the exact type of the object that will be created.</p>

<h2 id="implementation-1">Implementation</h2>

<p>The example implementation shows how to provide a data store with different
backends such as in-memory, disk storage.</p>

<h3 id="types">Types</h3>

<pre><code>package data

import &quot;io&quot;

type Store interface {
    Open(string) (io.ReadWriteCloser, error)
}
</code></pre>

<h3 id="different-implementations">Different Implementations</h3>

<pre><code>package data

type StorageType int

const (
    DiskStorage StorageType = 1 &lt;&lt; iota
    TempStorage
    MemoryStorage
)

func NewStore(t StorageType) Store {
    switch t {
    case MemoryStorage:
        return newMemoryStorage( /*...*/ )
    case DiskStorage:
        return newDiskStorage( /*...*/ )
    default:
        return newTempStorage( /*...*/ )
    }
}
</code></pre>

<h2 id="usage-1">Usage</h2>

<p>With the factory method, the user can specify the type of storage they want.</p>

<pre><code>s, _ := data.NewStore(data.MemoryStorage)
f, _ := s.Open(&quot;file&quot;)

n, _ := f.Write([]byte(&quot;data&quot;))
defer f.Close()
</code></pre>

<h1 id="object-pool-pattern">Object Pool Pattern</h1>

<p>The object pool creational design pattern is used to prepare and keep multiple
instances according to the demand expectation.</p>

<h2 id="implementation-2">Implementation</h2>

<pre><code>package pool

type Pool chan *Object

func New(total int) *Pool {
	p := make(Pool, total)

	for i := 0; i &lt; total; i++ {
		p &lt;- new(Object)
	}

	return &amp;p
}
</code></pre>

<h2 id="usage-2">Usage</h2>

<p>Given below is a simple lifecycle example on an object pool.</p>

<pre><code>p := pool.New(2)

select {
case obj := &lt;-p:
	obj.Do( /*...*/ )

	p &lt;- obj
default:
	// No more objects left — retry later or fail
	return
}
</code></pre>

<h2 id="rules-of-thumb">Rules of Thumb</h2>

<ul>
<li>Object pool pattern is useful in cases where object initialization is more
expensive than the object maintenance.</li>
<li>If there are spikes in demand as opposed to a steady demand, the maintenance
overhead might overweigh the benefits of an object pool.</li>
<li>It has positive effects on performance due to objects being initialized beforehand.</li>
</ul>

<h1 id="singleton-pattern">Singleton Pattern</h1>

<p>Singleton creational design pattern restricts the instantiation of a type to a single object.</p>

<h2 id="implementation-3">Implementation</h2>

<pre><code>package singleton

type singleton map[string]string

var (
    once sync.Once

    instance singleton
)

func New() singleton {
	once.Do(func() {
		instance = make(singleton)
	})

	return instance
}
</code></pre>

<h2 id="usage-3">Usage</h2>

<pre><code>s := singleton.New()

s[&quot;this&quot;] = &quot;that&quot;

s2 := singleton.New()

fmt.Println(&quot;This is &quot;, s2[&quot;this&quot;])
// This is that
</code></pre>

<h2 id="rules-of-thumb-1">Rules of Thumb</h2>

<ul>
<li>Singleton pattern represents a global state and most of the time reduces testability.</li>
</ul>

<h1 id="abstract-factory">Abstract Factory</h1>

<p>Provide an interface for creating famili es of related or dependent objects without specifying their concrete classes.</p>

<pre><code>package abstract_factory

import (
	&quot;fmt&quot;
	&quot;errors&quot;
)

//sub factory abstractions
type VehicleFactory interface {
	Create(int) (Vehiche, error)
}

type CarFactory struct{}
func (f *CarFactory) Create(vType int) (Vehiche, error) {
	switch vType {
	case OFFROADER_CAR:
		return new(Offroader), nil
	case SPORT_CAR:
		return new(Sportcar), nill
	default: 
		return nil, errors.New(fmt.Sprintf(&quot;Unsupported car vehicle type:%d&quot;, vType))
	}
}

type BusFactory struct {}
func(f *BusFactory) Create(vType int)(Vehiche, error) {
	switch vType {
	case CITY_TOUR_BUS:
		return new(CityTourBus), nil
	case SIMPLE_BUS:
		return new(SimpleBus), nil
	default: 
		return nil, errors.New(fmt.Sprintf(&quot;Unsupported bus vehicle type:%d&quot;, vType))
	}
}

//object families............
type Vehiche interface {
	WheelCount() int
}

//Car
const (
	OFFROADER_CAR = 1
	SPORT_CAR = 2
)

type Car interface {
	DoorCount() int
}

type Offroader struct{}
func (c Offroader) WheelCount() int {
	return 4
}
func (c Offroader) DoorCount() int {
	return 4
}

type Sportcar struct{}
func (c Sportcar) WheelCount() int {
	return 4
}
func (c Sportcar) DoorCount() int {
	return 2
}

//Bus..................
const (
	SIMPLE_BUS = 1
	CITY_TOUR_BUS = 2
)

type Bus interface {
	FloorCount() int
}

type CityTourBus struct{}
func (c CityTourBus) WheelCount() int {
	return 6
}
func (c CityTourBus) FloorCount() int {
	return 2
}

type SimpleBus struct{}
func (c SimpleBus) WheelCount() int {
	return 4
}
func (c SimpleBus) FloorCount() int {
	return 1
}

//super factory
const (
	CAR = 1
	BUS = 2
)

func CreateVehicleFactory(vfType int) (VehicleFactory, error) {
	switch vfType {
	case CAR:
		return new(CarFactory), nil
	case BUS:
		return new(BusFactory), nil
	default: 
		return nil, errors.New(&quot;Unrecognized factory type:%d&quot;, vfType)
	}
}
</code></pre>

</article>



</div>
</div>
<script src="/js/theme.min.js" type="text/javascript"></script>


</body>
</html>

